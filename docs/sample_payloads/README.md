# Sample Payloads for Testing

This directory contains sample JSON payloads for testing the Rwanda Primary Care patient endpoints.

## Files

### Search Operations

1. **search_by_nid.json**
   - Search patient by National ID
   - Endpoint: `POST /module/rwandaprimarycare/findPatient/byDocument`

2. **search_by_passport.json**
   - Search patient by Passport number
   - Endpoint: `POST /module/rwandaprimarycare/findPatient/byDocument`

3. **search_by_primary_care_id.json**
   - Search patient by Primary Care ID
   - Endpoint: `POST /module/rwandaprimarycare/findPatient/byDocument`
   - **Note:** Generate valid PC ID using `/Users/smallgod/openmrs/rwanda-emr/docs/scripts/generate_pc_id.py`

4. **search_by_insurance.json**
   - Search patient by Insurance Policy Number
   - Endpoint: `POST /module/rwandaprimarycare/findPatient/byDocument`
   - **Requires:** MOH Billing module

5. **search_by_name.json**
   - Search patient by name and year of birth
   - Endpoint: `POST /module/rwandaprimarycare/findPatient/byNames`

### Create Operations

6. **create_patient_full.json**
   - Create patient with all optional fields
   - Endpoint: `POST /module/rwandaprimarycare/findPatient/create`
   - **Important:** Replace Primary Care ID with valid one generated by `generate_pc_id.py`

7. **create_patient_minimal.json**
   - Create patient with minimal required fields
   - Endpoint: `POST /module/rwandaprimarycare/findPatient/create`
   - **Important:** Replace Primary Care ID with valid one generated by `generate_pc_id.py`

### Update Operations

8. **update_patient.json**
   - Update existing patient
   - Endpoint: `PUT /module/rwandaprimarycare/findPatient/update`
   - **Important:** Must include valid PRIMARY_CARE_ID or UPI identifier

### Other Operations

9. **generate_tracnet.json**
   - Generate Tracnet ID for patient
   - Endpoint: `POST /module/rwandaprimarycare/findPatient/generateTracnet`

## Usage

### With curl

```bash
# 1. Authenticate first
bash /Users/smallgod/openmrs/rwanda-emr/docs/scripts/test_emr_auth.sh

# 2. Test search by NID
curl -b /tmp/openmrs_cookies.txt \
  -H "Content-Type: application/json" \
  -X POST \
  -d @search_by_nid.json \
  "http://localhost:8080/openmrs/module/rwandaprimarycare/findPatient/byDocument"

# 3. Create patient (after generating valid PC ID)
curl -b /tmp/openmrs_cookies.txt \
  -H "Content-Type: application/json" \
  -X POST \
  -d @create_patient_minimal.json \
  "http://localhost:8080/openmrs/module/rwandaprimarycare/findPatient/create"

# 4. Update patient
curl -b /tmp/openmrs_cookies.txt \
  -H "Content-Type: application/json" \
  -X PUT \
  -d @update_patient.json \
  "http://localhost:8080/openmrs/module/rwandaprimarycare/findPatient/update"
```

### With Postman

1. **Import Collection:**
   - Import these JSON files as requests in Postman
   - Set base URL variable: `{{baseUrl}} = http://localhost:8080/openmrs`

2. **Authentication:**
   - Use Basic Auth with OpenMRS credentials
   - Or manually set cookie after authenticating via `test_emr_auth.sh`

3. **Headers:**
   - `Content-Type: application/json`
   - `Cookie: JSESSIONID=...` (if using cookie authentication)

## Important Notes

### Primary Care ID Generation

Always use the script to generate valid Primary Care IDs:

```bash
python3 /Users/smallgod/openmrs/rwanda-emr/docs/scripts/generate_pc_id.py
```

Example output:
```
Generated Valid Primary Care IDs:
1. 246801-U - Valid: True
2. 975321-K - Valid: True
3. 135790-F - Valid: True
```

Copy one of these IDs and replace the `"value": "123456-X"` in your payload.

### Identifier Systems

Valid identifier system values:
- `NID` - National ID
- `NIN` - National Identification Number
- `PASSPORT` - Passport
- `PRIMARY_CARE_ID` - Primary Care ID (required for create/update)
- `UPI` - Universal Patient Identifier
- `INSURANCE_POLICY_NUMBER` - Insurance Policy Number
- `FOREIGNER_ID` - Foreigner ID

### Address Types

Valid address type values:
- `RESIDENTIAL` - Home address
- `WORK` - Work address
- `POSTAL` - Postal address
- `TEMPORARY` - Temporary address

### Gender Values

- `M` - Male
- `F` - Female

### Date Format

Always use ISO 8601 date format: `YYYY-MM-DD`

Example: `"1990-01-15"`

## Testing Workflow

### Recommended Test Sequence

1. **Search for existing patient:**
   ```bash
   curl ... -d @search_by_nid.json .../byDocument
   ```

2. **If not found, create new patient:**
   ```bash
   # Generate valid PC ID first
   python3 generate_pc_id.py

   # Update create_patient_minimal.json with generated ID
   # Then create
   curl ... -d @create_patient_minimal.json .../create
   ```

3. **Verify creation:**
   ```bash
   # Search by the PC ID you just used
   curl ... -d @search_by_primary_care_id.json .../byDocument
   ```

4. **Update patient:**
   ```bash
   # Update update_patient.json with same PC ID
   curl ... -d @update_patient.json .../update
   ```

5. **Verify update:**
   ```bash
   # Search again to see updated data
   curl ... -d @search_by_primary_care_id.json .../byDocument
   ```

## Troubleshooting

### "Invalid Primary Care ID"
- **Solution:** Generate a new valid ID using `generate_pc_id.py`
- PC IDs use Luhn Mod-24 checksum algorithm

### "Patient not found after creation"
- **Solution:** Wait 1-2 seconds for database commit
- Check OpenMRS logs for errors

### "Identifier not unique"
- **Solution:** The PC ID or NID already exists in the database
- Generate a new PC ID or use update endpoint instead

### "Authentication failed"
- **Solution:** Re-run `test_emr_auth.sh` to refresh session cookie
- Check username/password in the script

## Examples of Valid Data

### Rwandan Address Example
```json
{
  "type": "RESIDENTIAL",
  "country": "Rwanda",
  "state": "Kigali",
  "district": "Gasabo",
  "sector": "Remera",
  "cell": "Rukiri",
  "city": "Kigali",
  "postalCode": "KG123",
  "street": "KN 5 Ave"
}
```

### Rwandan Phone Number Format
```
+250788123456
+250722987654
```

### Marital Status Values
- `Single`
- `Married`
- `Divorced`
- `Widowed`
- `Separated`

### Education Level Values
- `None`
- `Primary`
- `Secondary`
- `University`
- `Vocational`

### Religion Values
- `Christian`
- `Muslim`
- `Other`
- `None`

## See Also

- **Testing Guide:** `../TESTING_GUIDE.md`
- **Implementation Docs:** `../PATIENT_SEARCH_IMPLEMENTATION.md`
- **Test Scripts:** `../test_patient_endpoints.sh`, `../quick_test_*.sh`
